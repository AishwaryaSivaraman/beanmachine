"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[6590],{3905:function(e,a,m){m.r(a),m.d(a,{MDXContext:function(){return o},MDXProvider:function(){return c},mdx:function(){return h},useMDXComponents:function(){return d},withMDXComponents:function(){return l}});var n=m(67294);function t(e,a,m){return a in e?Object.defineProperty(e,a,{value:m,enumerable:!0,configurable:!0,writable:!0}):e[a]=m,e}function s(){return s=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var m=arguments[a];for(var n in m)Object.prototype.hasOwnProperty.call(m,n)&&(e[n]=m[n])}return e},s.apply(this,arguments)}function r(e,a){var m=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),m.push.apply(m,n)}return m}function p(e){for(var a=1;a<arguments.length;a++){var m=null!=arguments[a]?arguments[a]:{};a%2?r(Object(m),!0).forEach((function(a){t(e,a,m[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(m)):r(Object(m)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(m,a))}))}return e}function i(e,a){if(null==e)return{};var m,n,t=function(e,a){if(null==e)return{};var m,n,t={},s=Object.keys(e);for(n=0;n<s.length;n++)m=s[n],a.indexOf(m)>=0||(t[m]=e[m]);return t}(e,a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)m=s[n],a.indexOf(m)>=0||Object.prototype.propertyIsEnumerable.call(e,m)&&(t[m]=e[m])}return t}var o=n.createContext({}),l=function(e){return function(a){var m=d(a.components);return n.createElement(e,s({},a,{components:m}))}},d=function(e){var a=n.useContext(o),m=a;return e&&(m="function"==typeof e?e(a):p(p({},a),e)),m},c=function(e){var a=d(e.components);return n.createElement(o.Provider,{value:a},e.children)},N={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},x=n.forwardRef((function(e,a){var m=e.components,t=e.mdxType,s=e.originalType,r=e.parentName,o=i(e,["components","mdxType","originalType","parentName"]),l=d(m),c=t,x=l["".concat(r,".").concat(c)]||l[c]||N[c]||s;return m?n.createElement(x,p(p({ref:a},o),{},{components:m})):n.createElement(x,p({ref:a},o))}));function h(e,a){var m=arguments,t=a&&a.mdxType;if("string"==typeof e||t){var s=m.length,r=new Array(s);r[0]=x;var p={};for(var i in a)hasOwnProperty.call(a,i)&&(p[i]=a[i]);p.originalType=e,p.mdxType="string"==typeof e?e:t,r[1]=p;for(var o=2;o<s;o++)r[o]=m[o];return n.createElement.apply(null,r)}return n.createElement.apply(null,m)}x.displayName="MDXCreateElement"},99256:function(e,a,m){m.r(a),m.d(a,{contentTitle:function(){return i},default:function(){return c},frontMatter:function(){return p},metadata:function(){return o},toc:function(){return l}});var n=m(87462),t=m(63366),s=(m(67294),m(3905)),r=["components"],p={id:"posterior_predictive_checks",title:"Posterior Predictive Checks",sidebar_label:"Posterior Predictive Checks",slug:"/posterior_predictive_checks"},i=void 0,o={unversionedId:"framework_topics/model_evaluation/posterior_predictive_checks",id:"framework_topics/model_evaluation/posterior_predictive_checks",title:"Posterior Predictive Checks",description:"Evaluating probabilistic models is a challenging effort and an open research problem.  A common way to evaluate how well your model fits the data is to do posterior predictive checking , i.e. how well a model's predictions match the data.",source:"@site/../docs/framework_topics/model_evaluation/posterior_predictive_checks.md",sourceDirName:"framework_topics/model_evaluation",slug:"/posterior_predictive_checks",permalink:"/docs/posterior_predictive_checks",editUrl:"https://github.com/facebookresearch/beanmachine/edit/main/website/../docs/framework_topics/model_evaluation/posterior_predictive_checks.md",tags:[],version:"current",frontMatter:{id:"posterior_predictive_checks",title:"Posterior Predictive Checks",sidebar_label:"Posterior Predictive Checks",slug:"/posterior_predictive_checks"}},l=[],d={toc:l};function c(e){var a=e.components,m=(0,t.Z)(e,r);return(0,s.mdx)("wrapper",(0,n.Z)({},d,m,{components:a,mdxType:"MDXLayout"}),(0,s.mdx)("p",null,"Evaluating probabilistic models is a challenging effort and an open research problem.  A common way to evaluate how well your model fits the data is to do ",(0,s.mdx)("em",{parentName:"p"},"posterior predictive checking")," ",(0,s.mdx)("sup",{parentName:"p",id:"fnref-1"},(0,s.mdx)("a",{parentName:"sup",href:"#fn-1",className:"footnote-ref"},"1")),", i.e. how well a model's predictions match the data."),(0,s.mdx)("div",{className:"math math-display"},(0,s.mdx)("span",{parentName:"div",className:"katex-display"},(0,s.mdx)("span",{parentName:"span",className:"katex"},(0,s.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,s.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML",display:"block"},(0,s.mdx)("semantics",{parentName:"math"},(0,s.mdx)("mrow",{parentName:"semantics"},(0,s.mdx)("mi",{parentName:"mrow"},"p"),(0,s.mdx)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,s.mdx)("msub",{parentName:"mrow"},(0,s.mdx)("mi",{parentName:"msub"},"x"),(0,s.mdx)("mrow",{parentName:"msub"},(0,s.mdx)("mi",{parentName:"mrow"},"n"),(0,s.mdx)("mi",{parentName:"mrow"},"e"),(0,s.mdx)("mi",{parentName:"mrow"},"w"))),(0,s.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"\u2223"),(0,s.mdx)("mi",{parentName:"mrow"},"x"),(0,s.mdx)("mo",{parentName:"mrow",stretchy:"false"},")"),(0,s.mdx)("mo",{parentName:"mrow"},"="),(0,s.mdx)("msub",{parentName:"mrow"},(0,s.mdx)("mi",{parentName:"msub"},"E"),(0,s.mdx)("mrow",{parentName:"msub"},(0,s.mdx)("mi",{parentName:"mrow"},"z"),(0,s.mdx)("mo",{parentName:"mrow"},"\u223c"),(0,s.mdx)("mi",{parentName:"mrow"},"p"),(0,s.mdx)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,s.mdx)("mi",{parentName:"mrow"},"z"),(0,s.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"\u2223"),(0,s.mdx)("mi",{parentName:"mrow"},"x"),(0,s.mdx)("mo",{parentName:"mrow",stretchy:"false"},")"))),(0,s.mdx)("mi",{parentName:"mrow"},"p"),(0,s.mdx)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,s.mdx)("msub",{parentName:"mrow"},(0,s.mdx)("mi",{parentName:"msub"},"x"),(0,s.mdx)("mrow",{parentName:"msub"},(0,s.mdx)("mi",{parentName:"mrow"},"n"),(0,s.mdx)("mi",{parentName:"mrow"},"e"),(0,s.mdx)("mi",{parentName:"mrow"},"w"))),(0,s.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"\u2223"),(0,s.mdx)("mi",{parentName:"mrow"},"z"),(0,s.mdx)("mo",{parentName:"mrow",stretchy:"false"},")")),(0,s.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"p(x_{new} | x) = E_{z\\sim p(z|x)} p(x_{new}|z)")))),(0,s.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.mdx)("span",{parentName:"span",className:"base"},(0,s.mdx)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,s.mdx)("span",{parentName:"span",className:"mord mathnormal"},"p"),(0,s.mdx)("span",{parentName:"span",className:"mopen"},"("),(0,s.mdx)("span",{parentName:"span",className:"mord"},(0,s.mdx)("span",{parentName:"span",className:"mord mathnormal"},"x"),(0,s.mdx)("span",{parentName:"span",className:"msupsub"},(0,s.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,s.mdx)("span",{parentName:"span",className:"vlist-r"},(0,s.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.151392em"}},(0,s.mdx)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"0em",marginRight:"0.05em"}},(0,s.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,s.mdx)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,s.mdx)("span",{parentName:"span",className:"mord mtight"},(0,s.mdx)("span",{parentName:"span",className:"mord mathnormal mtight"},"n"),(0,s.mdx)("span",{parentName:"span",className:"mord mathnormal mtight"},"e"),(0,s.mdx)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.02691em"}},"w"))))),(0,s.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,s.mdx)("span",{parentName:"span",className:"vlist-r"},(0,s.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,s.mdx)("span",{parentName:"span"})))))),(0,s.mdx)("span",{parentName:"span",className:"mord"},"\u2223"),(0,s.mdx)("span",{parentName:"span",className:"mord mathnormal"},"x"),(0,s.mdx)("span",{parentName:"span",className:"mclose"},")"),(0,s.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}}),(0,s.mdx)("span",{parentName:"span",className:"mrel"},"="),(0,s.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2777777777777778em"}})),(0,s.mdx)("span",{parentName:"span",className:"base"},(0,s.mdx)("span",{parentName:"span",className:"strut",style:{height:"1.1052em",verticalAlign:"-0.3551999999999999em"}}),(0,s.mdx)("span",{parentName:"span",className:"mord"},(0,s.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.05764em"}},"E"),(0,s.mdx)("span",{parentName:"span",className:"msupsub"},(0,s.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,s.mdx)("span",{parentName:"span",className:"vlist-r"},(0,s.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.34480000000000005em"}},(0,s.mdx)("span",{parentName:"span",style:{top:"-2.5198em",marginLeft:"-0.05764em",marginRight:"0.05em"}},(0,s.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,s.mdx)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,s.mdx)("span",{parentName:"span",className:"mord mtight"},(0,s.mdx)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.04398em"}},"z"),(0,s.mdx)("span",{parentName:"span",className:"mrel mtight"},"\u223c"),(0,s.mdx)("span",{parentName:"span",className:"mord mathnormal mtight"},"p"),(0,s.mdx)("span",{parentName:"span",className:"mopen mtight"},"("),(0,s.mdx)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.04398em"}},"z"),(0,s.mdx)("span",{parentName:"span",className:"mord mtight"},"\u2223"),(0,s.mdx)("span",{parentName:"span",className:"mord mathnormal mtight"},"x"),(0,s.mdx)("span",{parentName:"span",className:"mclose mtight"},")"))))),(0,s.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,s.mdx)("span",{parentName:"span",className:"vlist-r"},(0,s.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.3551999999999999em"}},(0,s.mdx)("span",{parentName:"span"})))))),(0,s.mdx)("span",{parentName:"span",className:"mord mathnormal"},"p"),(0,s.mdx)("span",{parentName:"span",className:"mopen"},"("),(0,s.mdx)("span",{parentName:"span",className:"mord"},(0,s.mdx)("span",{parentName:"span",className:"mord mathnormal"},"x"),(0,s.mdx)("span",{parentName:"span",className:"msupsub"},(0,s.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,s.mdx)("span",{parentName:"span",className:"vlist-r"},(0,s.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.151392em"}},(0,s.mdx)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"0em",marginRight:"0.05em"}},(0,s.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,s.mdx)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,s.mdx)("span",{parentName:"span",className:"mord mtight"},(0,s.mdx)("span",{parentName:"span",className:"mord mathnormal mtight"},"n"),(0,s.mdx)("span",{parentName:"span",className:"mord mathnormal mtight"},"e"),(0,s.mdx)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.02691em"}},"w"))))),(0,s.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,s.mdx)("span",{parentName:"span",className:"vlist-r"},(0,s.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,s.mdx)("span",{parentName:"span"})))))),(0,s.mdx)("span",{parentName:"span",className:"mord"},"\u2223"),(0,s.mdx)("span",{parentName:"span",className:"mord mathnormal",style:{marginRight:"0.04398em"}},"z"),(0,s.mdx)("span",{parentName:"span",className:"mclose"},")")))))),(0,s.mdx)("p",null,"In Bean Machine, samples can be generated from the model via ",(0,s.mdx)("a",{parentName:"p",href:"https://beanmachine.org/api/beanmachine.ppl.inference.predictive.html?beanmachine.ppl.inference.predictive.Predictive.simulate#beanmachine.ppl.inference.predictive.simulate"},(0,s.mdx)("inlineCode",{parentName:"a"},"simulate")),". Let's take the earlier model of inferring bias of a coin."),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-python"},"@bm.random_variable\ndef coin_bias():\n   return dist.Beta(2, 2)\n\n@bm.random_variable\ndef coin_toss(i):\n    return dist.Bernoulli(coin_bias())\n")),(0,s.mdx)("p",null,"We can generate synthetic data from our model as follows:"),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-python"},"true_coin_bias = 0.75\ncoin_true_distribution = dist.Bernoulli(true_coin_bias)\nflip_count = 100\n\nqueries = [coin_bias()]\nobservations = {coin_toss(i): coin_data[i] for i in range(flip_count)}\n\n# simulate from the prior\nx_new = simulate(queries + list(observations.keys()),\n                 num_samples=1)\nassert isinstance(x_new, MonteCarloSamples)\n\n# Print out some generated coin tosses from our model.\nprint([x_new[coin_toss(i)] for i in range(flip_count)])\n")),(0,s.mdx)("p",null,"This is also known as a prior predictive. Now lets say we've run inference to learn more sensible distributions for our random variables, and we'd like to generate new data with our learned model.\nTo generate the (empirical) ",(0,s.mdx)("em",{parentName:"p"},"posterior")," predictive distribution ",(0,s.mdx)("span",{parentName:"p",className:"math math-inline"},(0,s.mdx)("span",{parentName:"span",className:"katex"},(0,s.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,s.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,s.mdx)("semantics",{parentName:"math"},(0,s.mdx)("mrow",{parentName:"semantics"},(0,s.mdx)("mi",{parentName:"mrow"},"p"),(0,s.mdx)("mo",{parentName:"mrow",stretchy:"false"},"("),(0,s.mdx)("msub",{parentName:"mrow"},(0,s.mdx)("mi",{parentName:"msub"},"x"),(0,s.mdx)("mrow",{parentName:"msub"},(0,s.mdx)("mi",{parentName:"mrow"},"n"),(0,s.mdx)("mi",{parentName:"mrow"},"e"),(0,s.mdx)("mi",{parentName:"mrow"},"w"))),(0,s.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"\u2223"),(0,s.mdx)("mi",{parentName:"mrow"},"x"),(0,s.mdx)("mo",{parentName:"mrow",stretchy:"false"},")")),(0,s.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"p(x_{new}|x)")))),(0,s.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,s.mdx)("span",{parentName:"span",className:"base"},(0,s.mdx)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,s.mdx)("span",{parentName:"span",className:"mord mathnormal"},"p"),(0,s.mdx)("span",{parentName:"span",className:"mopen"},"("),(0,s.mdx)("span",{parentName:"span",className:"mord"},(0,s.mdx)("span",{parentName:"span",className:"mord mathnormal"},"x"),(0,s.mdx)("span",{parentName:"span",className:"msupsub"},(0,s.mdx)("span",{parentName:"span",className:"vlist-t vlist-t2"},(0,s.mdx)("span",{parentName:"span",className:"vlist-r"},(0,s.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.151392em"}},(0,s.mdx)("span",{parentName:"span",style:{top:"-2.5500000000000003em",marginLeft:"0em",marginRight:"0.05em"}},(0,s.mdx)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,s.mdx)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,s.mdx)("span",{parentName:"span",className:"mord mtight"},(0,s.mdx)("span",{parentName:"span",className:"mord mathnormal mtight"},"n"),(0,s.mdx)("span",{parentName:"span",className:"mord mathnormal mtight"},"e"),(0,s.mdx)("span",{parentName:"span",className:"mord mathnormal mtight",style:{marginRight:"0.02691em"}},"w"))))),(0,s.mdx)("span",{parentName:"span",className:"vlist-s"},"\u200b")),(0,s.mdx)("span",{parentName:"span",className:"vlist-r"},(0,s.mdx)("span",{parentName:"span",className:"vlist",style:{height:"0.15em"}},(0,s.mdx)("span",{parentName:"span"})))))),(0,s.mdx)("span",{parentName:"span",className:"mord"},"\u2223"),(0,s.mdx)("span",{parentName:"span",className:"mord mathnormal"},"x"),(0,s.mdx)("span",{parentName:"span",className:"mclose"},")"))))),", we call ",(0,s.mdx)("inlineCode",{parentName:"p"},"simulate()")," on our posterior samples returned by ",(0,s.mdx)("inlineCode",{parentName:"p"},"infer()"),". Note that this time, the first argument\nto ",(0,s.mdx)("inlineCode",{parentName:"p"},"simulate")," is only the observations since those are the values we are querying. The samples for the other random variables have already been collected from inference."),(0,s.mdx)("pre",null,(0,s.mdx)("code",{parentName:"pre",className:"language-python"},"# run inference\nnum_infer_samples = 30\nnum_sim_samples = 50\nposterior = mcmc.infer(queries, obs, num_samples=30)\n\n# generate predictives from our posterior\nx_post_pred = simulate(observations.keys(),\n                       posterior=posterior,\n                       num_samples=100)\nassert x_post_pred[queries[0]].shape == (1, num_infer_samples, num_sim_samples)\n")),(0,s.mdx)("p",null,"Note the shape here; since ",(0,s.mdx)("inlineCode",{parentName:"p"},"simulate")," is an inference subroutine under the hood (one in which we just forward sample the model), in theory, it can be run with multiple chains. For this example,\nwe only have one chain. Then for each Monte Carlo sample of our posterior, we sample ",(0,s.mdx)("inlineCode",{parentName:"p"},"num_sim_samples")," many coin flips. We can then use ",(0,s.mdx)("a",{parentName:"p",href:"https://beanmachine.org/api/beanmachine.ppl.html#beanmachine.ppl.empirical"},(0,s.mdx)("inlineCode",{parentName:"a"},"Empirical")),"\nto sample from this resulting bag of samples. From here, one can compute various statistics on the posterior predictive data and compare with the ground truth data to assess model fitness."),(0,s.mdx)("div",{className:"footnotes"},(0,s.mdx)("hr",{parentName:"div"}),(0,s.mdx)("ol",{parentName:"div"},(0,s.mdx)("li",{parentName:"ol",id:"fn-1"},"Gelman, A., et al. ",(0,s.mdx)("em",{parentName:"li"},"Understanding predictive information criteria for Bayesian models"),". ",(0,s.mdx)("a",{parentName:"li",href:"https://arxiv.org/abs/1307.5928"},"https://arxiv.org/abs/1307.5928"),".",(0,s.mdx)("a",{parentName:"li",href:"#fnref-1",className:"footnote-backref"},"\u21a9")))))}c.isMDXComponent=!0}}]);