<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.13">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Bean Machine RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Bean Machine Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.css"><title data-react-helmet="true">Compositional Inference | Bean Machine</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://beanmachine.org/docs/compositional_inference/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Compositional Inference | Bean Machine"><meta data-react-helmet="true" name="description" content="Sometimes it might be hard to pick a single algorithm that performs well on the entire model. For example, while gradient-based algorithms such as No-U-Turn Sampler and Newtonian Monte Carlo generally yield high number of effective samples, they can only handle random variables with continuous support. On the other hand, while single site algorithms make it easier to update high-dimensional models by proposing only one node at a time, they might have trouble updating models with highly correlated random variables. Fortunately, Bean Machine supports composable inference through the CompositionalInference class, which allows us to use different inference methods to update different subset of nodes and to &quot;block&quot; multiple nodes together so that they are accepted/rejected jointly by a single Metropolis-Hastings step. In this doc, we will cover the basics of CompositionalInference and how to mix-and-match different inference algorithms. To learn about how to do &quot;block inference&quot; with CompositionalInference, see Block Inference."><meta data-react-helmet="true" property="og:description" content="Sometimes it might be hard to pick a single algorithm that performs well on the entire model. For example, while gradient-based algorithms such as No-U-Turn Sampler and Newtonian Monte Carlo generally yield high number of effective samples, they can only handle random variables with continuous support. On the other hand, while single site algorithms make it easier to update high-dimensional models by proposing only one node at a time, they might have trouble updating models with highly correlated random variables. Fortunately, Bean Machine supports composable inference through the CompositionalInference class, which allows us to use different inference methods to update different subset of nodes and to &quot;block&quot; multiple nodes together so that they are accepted/rejected jointly by a single Metropolis-Hastings step. In this doc, we will cover the basics of CompositionalInference and how to mix-and-match different inference algorithms. To learn about how to do &quot;block inference&quot; with CompositionalInference, see Block Inference."><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://beanmachine.org/docs/compositional_inference/"><link data-react-helmet="true" rel="alternate" href="https://beanmachine.org/docs/compositional_inference/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://beanmachine.org/docs/compositional_inference/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.d43d83ac.css">
<link rel="preload" href="/assets/js/runtime~main.8672907a.js" as="script">
<link rel="preload" href="/assets/js/main.9adb6f11.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/beanmachine.svg" alt="Bean Machine Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/beanmachine.svg" alt="Bean Machine Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Bean Machine</b></a><a class="navbar__item navbar__link" href="/docs/overview/why_bean_machine/">Docs</a><a class="navbar__item navbar__link" href="/docs/tutorials/">Tutorials</a><a href="/api/index.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>API<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebookresearch/beanmachine" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/overview/why_bean_machine/">Overview</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/docs/world/">Framework</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/world/">Worlds and Variables</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/inference/">Inference Methods</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" tabindex="0" href="/docs/programmable_inference/">Custom Inference</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/programmable_inference/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/custom_proposers/">Proposers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/compositional_inference/">Compositional Inference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/block_inference/">Block Inference</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/diagnostics/">Model Evaluation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/logging/">Development</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/beanstalk/">Advanced</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/tutorials/">Tutorials</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_XoVD"><div class="docItemContainer_6jsP"><article><header><h1 class="docTitle_ft6A">Compositional Inference</h1></header><div class="markdown"><p>Sometimes it might be hard to pick a single algorithm that performs well on the entire model. For example, while gradient-based algorithms such as <a href="/docs/no_u_turn_sampler/">No-U-Turn Sampler</a> and <a href="/docs/newtonian_monte_carlo/">Newtonian Monte Carlo</a> generally yield high number of effective samples, they can only handle random variables with continuous support. On the other hand, while single site algorithms make it easier to update high-dimensional models by proposing only one node at a time, they might have trouble updating models with highly correlated random variables. Fortunately, Bean Machine supports composable inference through the <code>CompositionalInference</code> class, which allows us to use different inference methods to update different subset of nodes and to &quot;block&quot; multiple nodes together so that they are accepted/rejected jointly by a single Metropolis-Hastings step. In this doc, we will cover the basics of <code>CompositionalInference</code> and how to mix-and-match different inference algorithms. To learn about how to do &quot;block inference&quot; with <code>CompositionalInference</code>, see <a href="/docs/block_inference/">Block Inference</a>.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="default-inference-methods">Default Inference Methods<a aria-hidden="true" class="hash-link" href="#default-inference-methods" title="Direct link to heading">â€‹</a></h2><p>By default, Compositional Inference will pick a single site algorithm to update each of the latent variable in the model based on its support:</p><table><thead><tr><th>Support</th><th>Algorithm</th></tr></thead><tbody><tr><td>real</td><td><code>SingleSiteNewtonianMonteCarlo</code> (real space proposer)</td></tr><tr><td>greater than</td><td><code>SingleSiteNewtonianMonteCarlo</code> (half space proposer)</td></tr><tr><td>simplex</td><td><code>SingleSiteNewtonianMonteCarlo</code> (simplex space proposer)</td></tr><tr><td>finite discrete</td><td><code>SingleSiteUniformMetropolisHastings</code></td></tr><tr><td>everything else</td><td><code>SingleSiteAncestralMetropolisHastings</code></td></tr></tbody></table><p>To run <code>CompositionalInference</code> with these default inference methods, simply leave the inference argument empty:</p><div class="codeBlockContainer_J+bg language-py"><div class="codeBlockContent_csEI py"><pre tabindex="0" class="prism-code language-py codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CompositionalInference</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">infer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    queries</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    observations</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    num_samples</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    num_chains</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    num_adaptive_samples</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The parameters to <code>infer</code> are described below:</p><table><thead><tr><th>Name</th><th>Usage</th></tr></thead><tbody><tr><td><code>queries</code></td><td>A <code>List</code> of <code>@bm.random_variable</code> targets to fit posterior distributions for.</td></tr><tr><td><code>observations</code></td><td>The <code>Dict</code> of observations. Each key is a random variable, and its value is the observed value for that random variable.</td></tr><tr><td><code>num_samples</code></td><td>Number of samples to build up distributions for the values listed in <code>queries</code>.</td></tr><tr><td><code>num_chains</code></td><td>Number of separate inference runs to use. Multiple chains can be used by diagnostics to verify inference ran correctly.</td></tr><tr><td><code>num_adaptive_samples</code></td><td>The integer number of samples to spend before <code>num_samples</code> on tuning the inference algorithm for the <code>queries</code>.</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_y2LR" id="configuring-your-own-inference">Configuring Your Own Inference<a aria-hidden="true" class="hash-link" href="#configuring-your-own-inference" title="Direct link to heading">â€‹</a></h2><p><code>CompositionalInference</code> also takes an optional dictionary, namely, the <code>inference_dict</code>, which can be used to override the default behavior.
In the following sections, assume that we&#x27;re working with a toy model with three random variable families, <code>foo</code>, <code>bar</code>, and <code>baz</code>:</p><div class="codeBlockContainer_J+bg language-py"><div class="codeBlockContent_csEI py"><pre tabindex="0" class="prism-code language-py codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token decorator annotation punctuation" style="color:rgb(199, 146, 234)">@bm</span><span class="token decorator annotation punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token decorator annotation punctuation" style="color:rgb(199, 146, 234)">random_variable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> dist</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Beta</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:rgb(199, 146, 234)">@bm</span><span class="token decorator annotation punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token decorator annotation punctuation" style="color:rgb(199, 146, 234)">random_variable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> dist</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Bernoulli</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:rgb(199, 146, 234)">@bm</span><span class="token decorator annotation punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token decorator annotation punctuation" style="color:rgb(199, 146, 234)">random_variable</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">baz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">j</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> dist</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Normal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="choosing-different-inference-methods-for-different-random-variable-families">Choosing different inference methods for different random variable families<a aria-hidden="true" class="hash-link" href="#choosing-different-inference-methods-for-different-random-variable-families" title="Direct link to heading">â€‹</a></h3><p>To select an inference algorithm for a particular random variable family, pass the random variable family as the key and an instance of the inference algorithm as value.
For example, the following snippet tells <code>CompositionalInference</code> to use <code>SingleSiteNoUTurnSampler()</code> to update all instances of <code>foo</code> and <code>SingleSiteHamiltonianMonteCarlo(1.0)</code> to update all instance of <code>baz</code>.
Nodes that are not specified, such as instances of <code>bar</code>, will fall back to the default inference methods mentioned above.</p><div class="codeBlockContainer_J+bg language-py"><div class="codeBlockContent_csEI py"><pre tabindex="0" class="prism-code language-py codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">bm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CompositionalInference</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> bm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">SingleSiteNoUTurnSampler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    baz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> bm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">SingleSiteHamiltonianMonteCarlo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">trajectory_length</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">infer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">**</span><span class="token plain">args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># same parameters as shown above</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>You may notice that we are using what we referred to as &quot;random variable families&quot; like <code>foo</code> as keys, which are essentially functions that generates the random variables, instead of using instances of random variables such as <code>foo(0)</code> and <code>foo(1)</code>. This is because often times the number of random variable is not known ahead of time until an inference starts with some data (you can even have unbounded number of nodes in some model). By using random variable family in the config, we no longer need to explicitly spell out all every instance in a huge dictionary.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="overriding-default-inference-method">Overriding default inference method<a aria-hidden="true" class="hash-link" href="#overriding-default-inference-method" title="Direct link to heading">â€‹</a></h3><p>If your model has a large number of nodes and you want to override the default inference method for all of them without listing them all, you can use Python&#x27;s <code>Ellipsis</code> literal, or equivalently, <code>...</code> (three dots), as a key to specify the default inference method for nodes that are not specified in the dictionary. For example, the following code snippet tells <code>CompositionalInference</code> to use <code>SingleSiteUniformMetropolisHastings()</code> to update all instances of <code>bar</code> (which are discrete), and use <code>SingleSiteNoUTurnSampler()</code> to update the rest of nodes (which are all continuous).</p><div class="codeBlockContainer_J+bg language-py"><div class="codeBlockContent_csEI py"><pre tabindex="0" class="prism-code language-py codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">bm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">CompositionalInference</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> bm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">SingleSiteUniformMetropolisHastings</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> bm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">SingleSiteNoUTurnSampler</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">infer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">**</span><span class="token plain">args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># same parameters as shown above</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Bean Machine provides a great variety of inference methods under <a href="https://beanmachine.org/api/beanmachine.ppl.inference.html" target="_blank" rel="noopener noreferrer"><code>beanmachine.ppl.inference</code></a> that can be used with the <code>CompositionalInference</code> API. To learn more about what else can be done with <code>CompositionalInference</code>, see <a href="/docs/block_inference/">Block Inference</a>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"></div></div><br><div class="row"><div class="col"><a href="https://github.com/facebookresearch/beanmachine/edit/main/website/../docs/framework_topics/custom_inference/compositional_inference.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#default-inference-methods" class="table-of-contents__link toc-highlight">Default Inference Methods</a></li><li><a href="#configuring-your-own-inference" class="table-of-contents__link toc-highlight">Configuring Your Own Inference</a><ul><li><a href="#choosing-different-inference-methods-for-different-random-variable-families" class="table-of-contents__link toc-highlight">Choosing different inference methods for different random variable families</a></li><li><a href="#overriding-default-inference-method" class="table-of-contents__link toc-highlight">Overriding default inference method</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noreferrer noopener" class="footer__link-item"><span>Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noreferrer noopener" class="footer__link-item"><span>Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_SRtH"><img src="/img/beanmachine.svg" alt="Bean Machine Logo" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/img/beanmachine.svg" alt="Bean Machine Logo" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></a></div><div class="footer__copyright">Copyright &#169; 2021 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.8672907a.js"></script>
<script src="/assets/js/main.9adb6f11.js"></script>
</body>
</html>