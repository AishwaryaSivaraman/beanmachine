<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Bean Machine RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Bean Machine Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-44373548-47","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.css"><title data-react-helmet="true">Worlds and Variables | Bean Machine</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://beanmachine.org/docs/variable/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Worlds and Variables | Bean Machine"><meta data-react-helmet="true" name="description" content="A crucial part of Bean Machine inference is its ability track the state of inference using Worlds. During inference, the World represents the state of the variables and their dependencies. The World is a graphical data structure where each node in the graph represents a Variable containing information about the variable&#x27;s value, distribution, probability, etc. The edges between nodes represent the dependencies between variables. Each variable tracks its parent variables as well as its children variables."><meta data-react-helmet="true" property="og:description" content="A crucial part of Bean Machine inference is its ability track the state of inference using Worlds. During inference, the World represents the state of the variables and their dependencies. The World is a graphical data structure where each node in the graph represents a Variable containing information about the variable&#x27;s value, distribution, probability, etc. The edges between nodes represent the dependencies between variables. Each variable tracks its parent variables as well as its children variables."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://beanmachine.org/docs/variable/"><link data-react-helmet="true" rel="alternate" href="https://beanmachine.org/docs/variable/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://beanmachine.org/docs/variable/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.01a22e7d.css">
<link rel="preload" href="/assets/js/runtime~main.e1bae547.js" as="script">
<link rel="preload" href="/assets/js/main.09462905.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/beanmachine.svg" alt="Bean Machine Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/beanmachine.svg" alt="Bean Machine Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Bean Machine</b></a><a class="navbar__item navbar__link" href="/docs/introduction/">Docs</a><a class="navbar__item navbar__link" href="/docs/tutorials/">Tutorials</a><a href="/api/index.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>API<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Framework</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Inference</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/inference/">Inference Methods</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Inference Methods</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Programmable Inference</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Custom Proposers</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/variable/">Worlds and Variables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/custom_proposers/">Proposers</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Model Evaluation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Advanced</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Development</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Advanced</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tutorials</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Packages</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Contributing</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Sitemap (formerly TOC)</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_XoVD"><div class="docItemContainer_6jsP"><article><header><h1 class="docTitle_ft6A">Worlds and Variables</h1></header><div class="markdown"><p>A crucial part of Bean Machine inference is its ability track the state of inference using <code>World</code>s. During inference, the <code>World</code> represents the state of the variables and their dependencies. The <code>World</code> is a graphical data structure where each node in the graph represents a <code>Variable</code> containing information about the variable&#x27;s value, distribution, probability, etc. The edges between nodes represent the dependencies between variables. Each variable tracks its parent variables as well as its children variables.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="rvidentifier">RVIdentifier<a aria-hidden="true" class="hash-link" href="#rvidentifier" title="Direct link to heading">â€‹</a></h2><p><code>RVIdentifier</code> is a dataclass used to identify the random variable and does not contain any of the inference information. It only consists of the variable&#x27;s <code>function</code> and <code>arguments</code> as supplied in the model declaration.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="variable">Variable<a aria-hidden="true" class="hash-link" href="#variable" title="Direct link to heading">â€‹</a></h2><p>The <code>Variable</code> class represents random variables in a model. Each <code>RVIdentifier</code> has a corresponding <code>Variable</code> and has the following attributes:</p><ul><li><code>distribution: Distribution</code> - the distribution of the variable according to the model in this particular <code>World</code></li><li><code>value: Tensor</code> - the value of the variable at the current state of inference</li><li><code>parent: Set[Optional[RVIdentifier]]</code> - the set of random variables called within the function declaration of the random variable</li><li><code>children: Set[Optional[RVIdentifier]]</code> - the set of random variables which call this variable in their function declaration</li><li><code>log_prob: Tensor</code> - the log probability of the value with the prior distribution</li><li><code>proposal_distribution: ProposalDistribution</code> - the proposal distribution used during inference</li><li><code>is_discrete: bool</code> - an indicator of whether it is a discrete variable as opposed to a continuous variable</li><li><code>transform: Transform</code> - a Transform to be applied in order to reshape the state space; see <a href="/docs/transforms/">Transform</a> documentation</li><li><code>transformed_value: Tensor</code> - the value of the variable in the transformed space. This value will be the same as <code>value</code> when no transforms are specified.</li><li><code>jacobian: Tensor</code> - the log Jacobian determinant of the transforms</li></ul><p>When writing custom proposers, the two most relevant functions within the <code>Variable</code> API are</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI py"><pre tabindex="0" class="prism-code language-py codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">transform_value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Tensor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> Tensor</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">inverse_transform_value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> transformed_value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Tensor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> Tensor</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>If a custom proposer needs to operate on the transformed space of values, then it will typically use <code>variable.transformed_value</code> as the starting point in the transformed space for computing a new proposed value. The new proposed value is then in the transformed space, but because custom proposer&#x27;s <code>propose</code> method must return a value in the <em>original</em> space, one must obtain the latter using <code>Variable.inverse_transform_value</code>. Naturally, if the custom proposer does not need a transformed space, then it can simply use <code>variable.value</code> and return the proposed new value without any need to transform it back to the original space.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="world">World<a aria-hidden="true" class="hash-link" href="#world" title="Direct link to heading">â€‹</a></h2><p>The <code>World</code> tracks the variables through the <code>WorldVars</code> class, which associates each <code>RVIdentifier</code> to a <code>Variable</code>. When new values are proposed to the <code>World</code> and the world is updated to reflect these changes, these changes are stored in the world&#x27;s <code>DiffStack</code>, which is a stack of <code>Diff</code>s, each tracking Variables with differing values probabilities, parents, children, etc.</p><p>When writing custom proposers for random variables, it is often important to access the <code>Variable</code> corresponding to the <code>RVIdentifier</code> to see the current value, sample from the variable&#x27;s prior distribution, etc. This can be done through the function</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI py"><pre tabindex="0" class="prism-code language-py codeBlock_rtdJ thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#bfc7d5"><span class="token plain">get_node_in_world</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">node</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> RVIdentifier</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> to_be_copied </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> to_create_new_diff </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">False</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li><code>to_be_copied</code>: a flag indicating if the world should copy this variable to the <code>DiffStack</code> and start tracking changes. Within the <code>proposal</code> method of a proposer, this should generally be set to False, as the world will automatically add the proposed value for the Variable to a <code>Diff</code> once the proposal method is completed.</li><li><code>to_create_new_diff</code>: whether an additional diff with these changes should be added to the top of the <code>DiffStack</code>. This should generally be set to False.</li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"></div></div><br><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/../docs/framework_topics/custom_proposers/variable.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/adaptive_inference/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Adaptation and Warmup</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/custom_proposers/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Proposers<!-- --> Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#rvidentifier" class="table-of-contents__link toc-highlight">RVIdentifier</a></li><li><a href="#variable" class="table-of-contents__link toc-highlight">Variable</a></li><li><a href="#world" class="table-of-contents__link toc-highlight">World</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_SRtH"><img src="/img/beanmachine.svg" alt="Bean Machine Logo" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/img/beanmachine.svg" alt="Bean Machine Logo" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></a></div><div class="footer__copyright">Copyright &#169; 2021 Facebook, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.e1bae547.js"></script>
<script src="/assets/js/main.09462905.js"></script>
</body>
</html>